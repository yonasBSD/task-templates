---
# https://taskfile.dev

version: '3'

vars:

tasks:

  check-url:
    desc: "Check response code of URL. Arguments: URL|U=http://url (*)"
    summary: |
      [SYSTEM] Check response code of URL.
      Usage: task system:check-url URL|U=http://url
      Arguments:
        URL | U  Url to check (required)

      Requirements:
        - curl
    vars:
      URL: '{{default .U .URL}}'
    cmds:
      - |
        http_code=$(curl -L -s -o /dev/null -w "%{http_code}" {{.URL}})
        if [ "${http_code}" != "200" ]; then
          printf "[\033[0;31m[KO] HTTP code: %s\033[0m\n" "${http_code}"
          exit 1
        else
          printf "\033[0;32m[OK] %s - %s \033[0m\n" "${http_code}" {{.URL}}
        fi
    preconditions:
      - sh: test -n "{{.URL}}" || test -n "{{.U}}"
        msg: "ARG|A argument is required"
    silent: true
