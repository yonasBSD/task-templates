---
# https://taskfile.dev

version: '3'

vars:

tasks:

  generate-key:
    desc: "Generate a SSH key pair. Arguments: KEY_PATH|K=key_path (*)"
    summary: |
      [SYSTEM] Generate a SSH key pair.
      Usage: task system:generate-key KEY|K=<key_path>

      Arguments:
       KEY | K  Path to the private key file (required)

      Requirements:
        - ssh-keygen
    vars:
      KEY: '{{default .K .KEY}}'
    cmds:
      - mkdir -p .ssh
      - chmod 700 .ssh
      # TODO: Set basename and date at generation in comment.
      - ssh-keygen -q -N "" -m PEM -t rsa -b 4096 -f "{{.KEY}}" -C "{{.KEY}}"
      - echo "Key {{.KEY}} generated"
    status:
      - test -f "{{.KEY}}"
    preconditions:
      - sh: command -v ssh-keygen
        msg: "ssh-keygen is not installed"
      - sh: test -n "{{.KEY}}" || test -n "{{.K}}"
        msg: "KEY|K argument is required"
    silent: true
