---
# https://taskfile.dev
#
# Taskfile.project.yml for your main project tasks. Must be commited.
# If you always want the last version of the task templates, add the following line in your .gitignore file
# /Taskfile.d/
#
version: '3'

vars:
  # TO MODIFY: Task templates to download separated by comma
  # Example: TASK_TEMPLATES: go,lint,yarn
  TASK_TEMPLATES: lint
  # Proxy URL can be configure bellow or as an argument of 00-install-templates
  TASK_PROXY: ""

tasks:

  00-install-templates:
    desc: "[PROJECT] Init and download tasks templates. Arguments: [PROXY|P=http://proxy:8080] [PROXY_CREDENTIALS|PC=username:password]"
    vars:
      PROXY: '{{default .P .PROXY}}'
      D_PROXY: '{{default .TASK_PROXY .PROXY}}'
      PROXY_CREDENTIALS: '{{default .PC .PROXY_CREDENTIALS}}'
    cmds:
      - date > {{.FILE_TASK_START}}
      - defer: rm -f {{.FILE_TASK_START}}
      - mkdir -p "{{.DIR_TASKFILES}}"
      - task install-templates TEMPLATE={{.TASK_TEMPLATES}} PROXY={{.D_PROXY}} PROXY_CREDENTIALS={{.PROXY_CREDENTIALS}}
      - echo "Install templates Start $(cat {{.FILE_TASK_START}}) - End $(date)"
    silent: true

  # Task example
  10-pre-commit:
    desc: "[PROJECT] Pre-commit checks."
    cmds:
      - date > {{.FILE_TASK_START}}
      - defer: rm -f {{.FILE_TASK_START}}
      - task lint:all MEX='"#.Taskfile.d"'
      - echo "Checks Start $(cat {{.FILE_TASK_START}}) - End $(date)"
    silent: true
